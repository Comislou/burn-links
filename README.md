# é˜…åå³ç„šçŸ­é“¾æ¥

ä¸€ä¸ªè‡ªç”¨çš„åŸºäº [Cloudflare Workers](https://workers.cloudflare.com/) å’Œ [KV](https://developers.cloudflare.com/workers/learning/how-kv-works/) æ„å»ºçš„é˜…åå³ç„šçŸ­é“¾æ¥æœåŠ¡ã€‚

ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæœ‰æ—¶æ•ˆæ€§ã€æœ‰è®¿é—®æ¬¡æ•°é™åˆ¶çš„çŸ­é“¾æ¥ã€‚ä¸€æ—¦è¾¾åˆ°é¢„è®¾æ¡ä»¶ï¼Œé“¾æ¥åŠå…¶æŒ‡å‘çš„å†…å®¹å°†è‡ªåŠ¨é”€æ¯ï¼Œéå¸¸é€‚åˆç”¨äºåˆ†äº«ä¸´æ—¶æˆ–æ•æ„Ÿä¿¡æ¯ã€‚

## âœ¨ ç‰¹æ€§

- **å®Œå…¨å…è´¹**: éƒ¨ç½²åœ¨ Cloudflare Workers çš„å…è´¹å¥—é¤ä¸Šï¼Œè¶³ä»¥æ»¡è¶³ç»å¤§å¤šæ•°ä¸ªäººä½¿ç”¨åœºæ™¯ã€‚
- **é«˜æ€§èƒ½**: åŸºäº Cloudflare çš„å…¨çƒè¾¹ç¼˜ç½‘ç»œï¼Œè®¿é—®é€Ÿåº¦æå¿«ã€‚
- **å®‰å…¨å¯é **: æ— éœ€ç®¡ç†æœåŠ¡å™¨ï¼Œä»£ç ä¸æ•æ„Ÿé…ç½®åˆ†ç¦»ï¼Œé€šè¿‡ GitHub Secrets å®‰å…¨éƒ¨ç½²ã€‚
- **é«˜åº¦å¯å®šåˆ¶**:
  - **è®¿é—®æ¬¡æ•°é™åˆ¶**: è®¾ç½®é“¾æ¥åœ¨è¢«è®¿é—® N æ¬¡åè‡ªåŠ¨é”€æ¯ (1-99æ¬¡ï¼Œæˆ–ä¸é™)ã€‚
  - **è¿‡æœŸæ—¶é—´**: è®¾ç½®é“¾æ¥åœ¨ 12 å°æ—¶åè‡ªåŠ¨é”€æ¯ï¼Œæˆ–é€‰æ‹©æ°¸ä¸è¿‡æœŸã€‚
  - **ä¸ªæ€§åŒ–å¤–è§‚**: å¯é€šè¿‡ç¯å¢ƒå˜é‡è½»æ¾è‡ªå®šä¹‰ç«™ç‚¹çš„æ ‡é¢˜ã€å›¾æ ‡å’ŒèƒŒæ™¯å›¾ç‰‡ã€‚
- **ä¸€é”®éƒ¨ç½²**: æä¾›å®Œæ•´çš„ GitHub Actions é…ç½®ï¼Œåªéœ€åœ¨ GitHub é¡µé¢è¿›è¡Œç®€å•çš„æ“ä½œå³å¯å®Œæˆéƒ¨ç½²ã€‚

## ğŸš€ éƒ¨ç½²æŒ‡å—

åªéœ€ 5 ä¸ªæ­¥éª¤ï¼Œå³å¯æ‹¥æœ‰å±äºä½ è‡ªå·±çš„é˜…åå³ç„šçŸ­é“¾æ¥æœåŠ¡ã€‚

### æ­¥éª¤ 1: Fork æœ¬é¡¹ç›®

ç‚¹å‡»æœ¬é¡¹ç›®é¡µé¢å³ä¸Šè§’çš„ **Fork** æŒ‰é’®ï¼Œå°†æ­¤é¡¹ç›®å¤åˆ¶åˆ°ä½ è‡ªå·±çš„ GitHub ä»“åº“ä¸­ã€‚

### æ­¥éª¤ 2: åˆ›å»º Cloudflare KV å‘½åç©ºé—´

æˆ‘ä»¬éœ€è¦ä¸€ä¸ª KV å‘½åç©ºé—´æ¥å­˜å‚¨çŸ­é“¾æ¥çš„æ•°æ®ã€‚

1. ç™»å½•åˆ° [Cloudflare ä»ªè¡¨æ¿](https://dash.cloudflare.com/)ã€‚
2. åœ¨å·¦ä¾§å¯¼èˆªæ ä¸­ï¼Œé€‰æ‹© **Workers & Pages** -> **KV**ã€‚
3. ç‚¹å‡» **Create a namespace** æŒ‰é’®ã€‚
4. åç§°éšæ„ï¼ˆä¾‹å¦‚ `short_links`ï¼‰ï¼Œç„¶åç‚¹å‡» **Add**ã€‚
5. åˆ›å»ºæˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°æ–°åˆ›å»ºçš„å‘½åç©ºé—´åˆ—è¡¨ã€‚**å¤åˆ¶å®ƒçš„ `ID`**ï¼Œæˆ‘ä»¬ç¨åä¼šç”¨åˆ°ã€‚

### æ­¥éª¤ 3: åˆ›å»º Cloudflare API ä»¤ç‰Œ

ä¸ºäº†è®© GitHub Actions æœ‰æƒé™éƒ¨ç½² Workerï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª API ä»¤ç‰Œã€‚

1. ç›´æ¥è®¿é—® [https://dash.cloudflare.com/?to=/:account/api-tokens](https://dash.cloudflare.com/?to=/:account/api-tokens)
2. ç‚¹å‡» **Create Token**ã€‚
3. åœ¨ä¸‹æ–¹æ‰¾åˆ° **Custom token** -> **Create Custom Token**ï¼Œç‚¹å‡» **Get Started**ã€‚
4. ä¸ºä½ çš„è‡ªå®šä¹‰ä»¤ç‰Œçš„è®¾ç½®åç§°ï¼ˆç¡®ä¿è‡ªå·±èƒ½çŸ¥é“ç”¨å¤„ï¼‰ã€‚åœ¨ **Permissions** ä¸­ï¼Œç‚¹å‡» **Select item...** å¹¶é€‰æ‹© **Workers Script** å¹¶ç¡®ä¿æƒé™ä¸º**Edit**ã€‚
5. å†ç‚¹å‡» **+Add more**ï¼Œç‚¹å‡» **Select item...** å¹¶é€‰æ‹© **Workers KV Storage** å¹¶ç¡®ä¿æƒé™ä¸º**Edit**ã€‚
6. ç‚¹å‡» **Continue to summary**åˆ°æ‘˜è¦é¡µé¢ï¼Œç‚¹å‡» **Create Token**ã€‚
7. **ç«‹å³ä¿å­˜ç”Ÿæˆçš„ä»¤ç‰Œ**ï¼è¿™æ˜¯å®ƒå”¯ä¸€ä¸€æ¬¡å®Œæ•´æ˜¾ç¤ºã€‚å¦¥å–„ä¿ç®¡ï¼Œå¦‚æœæ²¡æ¥å¾—åŠä¿å­˜å°±åˆ äº†åˆ›ä¸ªæ–°çš„ã€‚

> **è­¦å‘Š**: API ä»¤ç‰Œéå¸¸æ•æ„Ÿï¼Œè¯·å‹¿æ³„éœ²ç»™ä»»ä½•äººæˆ–æäº¤åˆ°ä»£ç ä»“åº“ä¸­ã€‚

### æ­¥éª¤ 4: åœ¨ GitHub ä¸­é…ç½® Secrets

è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†æŠŠä» Cloudflare è·å–çš„å‡­è¯å®‰å…¨åœ°æä¾›ç»™ GitHub Actionsã€‚

1. è¿›å…¥ä½  Fork åçš„ GitHub ä»“åº“é¡µé¢ã€‚
2. ç‚¹å‡» **Settings** -> **Secrets and variables** -> **Actions**ã€‚
3. ç‚¹å‡» **New repository secret** æŒ‰é’®ï¼Œä¾æ¬¡æ·»åŠ ä»¥ä¸‹ä¸‰ä¸ª Secretï¼š

    *   **`CLOUDFLARE_API_TOKEN`**:
        *   **å€¼**: ä½ åœ¨ **æ­¥éª¤ 3** ä¸­åˆ›å»ºå¹¶å¤åˆ¶çš„ API ä»¤ç‰Œã€‚

    *   **`CLOUDFLARE_ACCOUNT_ID`**:
        *   **å€¼**: ä¸éœ€è¦è®¾ç½®ï¼ŒActionä¼šè‡ªåŠ¨è·å–ï¼ˆå½“ç„¶ä½ æƒ³è®¾ç½®ä¹Ÿå¯ä»¥ï¼‰ã€‚

    *   **`CF_KV_NAMESPACE_ID`**:
        *   **å€¼**: ä½ åœ¨ **æ­¥éª¤ 2** ä¸­åˆ›å»ºå¹¶å¤åˆ¶çš„ KV å‘½åç©ºé—´ IDã€‚

    *   **`WORKER_NAME`**:
        *   **å€¼**: ä½ å¸Œæœ›ä¸º Worker è®¾ç½®çš„åç§°ã€‚

> **æ³¨æ„**: æ³¨æ„æ˜¯è®¾ç½®åˆ° Secrets è€Œä¸æ˜¯ Variablesã€‚

### æ­¥éª¤ 5: è¿è¡Œéƒ¨ç½² Action

ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼ç°åœ¨æˆ‘ä»¬æ¥æ‰§è¡Œéƒ¨ç½²ã€‚

1. åœ¨ä½ çš„ GitHub ä»“åº“é¡µé¢ï¼Œç‚¹å‡»é¡¶éƒ¨çš„ **Actions** æ ‡ç­¾ã€‚
2. åœ¨å·¦ä¾§åˆ—è¡¨ä¸­ï¼Œç‚¹å‡» **Deploy to Cloudflare Workers** å·¥ä½œæµã€‚
3. ç‚¹å‡» **Run workflow** ä¸‹æ‹‰æŒ‰é’®ã€‚
4. ç‚¹å‡»ç»¿è‰²çš„ **Run workflow** æŒ‰é’®ã€‚

ç­‰å¾…å‡ åˆ†é’Ÿï¼Œå½“å·¥ä½œæµæ‰§è¡ŒæˆåŠŸåï¼ŒæœåŠ¡å°±ä¸Šçº¿äº†ï¼

**è®¿é—®åœ°å€**: `https://<ä½ å¡«å†™çš„Workeråç§°>.<ä½ çš„Cloudflareå­åŸŸ>.workers.dev`

## ğŸ¨ è‡ªå®šä¹‰é…ç½®

ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹ `wrangler.toml.template` æ–‡ä»¶æ¥ä¸ªæ€§åŒ–ä½ çš„ç«™ç‚¹ã€‚

```toml
[vars]
# é»˜è®¤è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œ12å°æ—¶ = 43200ç§’
DEFAULT_TTL_SECONDS = 43200 
# ç«™ç‚¹å›¾æ ‡é“¾æ¥ï¼Œç•™ç©ºåˆ™ä½¿ç”¨ Cloudflare é»˜è®¤å›¾æ ‡
HOME_ICON = "" 
# ç«™ç‚¹ä¸»æ ‡é¢˜
TITLE = "é˜…åå³ç„š"
# PC ç«¯èƒŒæ™¯å›¾ API æˆ–é“¾æ¥
BACKGROUND = ""
# ç§»åŠ¨ç«¯èƒŒæ™¯å›¾ API æˆ–é“¾æ¥
BACKGROUND_VERTICAL = ""
```

ä¿®æ”¹åï¼Œé‡æ–°è¿è¡Œ GitHub Action å³å¯ç”Ÿæ•ˆã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- [Cloudflare Workers](https://workers.cloudflare.com/): Serverless æ‰§è¡Œç¯å¢ƒ
- [Cloudflare KV](https://developers.cloudflare.com/workers/learning/how-kv-works/): å…¨çƒåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨
- [itty-router](https://github.com/kwhitley/itty-router): è½»é‡çº§ Worker è·¯ç”±å™¨
- [nanoid](https://github.com/ai/nanoid): å°å·§ã€å®‰å…¨çš„ URLå‹å¥½å‹å”¯ä¸€IDç”Ÿæˆå™¨
- [GitHub Actions](https://github.com/features/actions): CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²

## ğŸ“„ è®¸å¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](./LICENSE) å¼€æº